# ä¸ªäººå¯¼èˆªç½‘ç«™

è¿™æ˜¯ä¸€ä¸ªåŸºäºFlaskå’ŒTailwindCSSæ„å»ºçš„ä¸ªäººå¯¼èˆªç½‘ç«™ï¼Œæä¾›åˆ†ç±»ç®¡ç†çš„é“¾æ¥å¯¼èˆªåŠŸèƒ½å’Œåå°ç®¡ç†ç³»ç»Ÿã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ æ¸…çˆ½ç®€æ´çš„å¯¼èˆªç•Œé¢
- ğŸ“‚ æ”¯æŒåŒºåŸŸå’Œåˆ†ç±»ä¸¤çº§ç®¡ç†
- ğŸ”— é“¾æ¥å¡ç‰‡å¼å±•ç¤º
- ğŸ›  å®Œæ•´çš„åå°ç®¡ç†ç³»ç»Ÿ
- ğŸ” ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- ğŸ’» å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®
- ğŸ“± æ”¯æŒåŒºåŸŸå’Œåˆ†ç±»çš„æ‹–æ‹½æ’åº
- ğŸ”„ æ”¯æŒæ•°æ®å¯¼å…¥å¯¼å‡º

## æŠ€æœ¯æ ˆ

- åç«¯: Python Flask
- å‰ç«¯: TailwindCSS
- æ•°æ®åº“: SQLite
- è®¤è¯: Flask-Login
- CSSå·¥å…·: PostCSS
- æ’åº: Sortable.js

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ app.py              # Flaskåº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ routes/            # è·¯ç”±æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ admin_routes.py # ç®¡ç†åå°è·¯ç”±
â”‚   â”œâ”€â”€ auth_routes.py  # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â””â”€â”€ main_routes.py  # å‰å°ä¸»è¦è·¯ç”±
â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ category.py    # åˆ†ç±»æ¨¡å‹
â”‚   â”œâ”€â”€ link.py       # é“¾æ¥æ¨¡å‹
â”‚   â””â”€â”€ user.py       # ç”¨æˆ·æ¨¡å‹
â”œâ”€â”€ schemas/          # åºåˆ—åŒ–æ¨¡å¼
â”œâ”€â”€ tests/           # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/            # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ api/         # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ testing/     # æµ‹è¯•æ–‡æ¡£
â”‚   â””â”€â”€ deployment/  # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ www/             # å‰ç«¯æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ css/        # ç¼–è¯‘åçš„CSS
â”‚   â”œâ”€â”€ src/        # æºCSSæ–‡ä»¶
â”‚   â”œâ”€â”€ js/         # JavaScriptæ–‡ä»¶
â”‚   â”œâ”€â”€ admin/      # åå°ç®¡ç†ç•Œé¢
â”‚   â””â”€â”€ index.html  # å‰å°é¦–é¡µ
â””â”€â”€ README.md       # é¡¹ç›®è¯´æ˜
```

## åŠŸèƒ½æ¨¡å—

### å‰å°å¯¼èˆª
- åˆ†åŒºå±•ç¤ºï¼šæ”¯æŒå¤šä¸ªåŒºåŸŸï¼ˆå¦‚å¸¸ç”¨ç½‘å€ã€å­¦ä¹ ã€å®¶åº­ç­‰ï¼‰
- åˆ†ç±»ç®¡ç†ï¼šæ¯ä¸ªåŒºåŸŸä¸‹å¯åŒ…å«å¤šä¸ªåˆ†ç±»
- é“¾æ¥å¡ç‰‡ï¼šç¾è§‚çš„å¡ç‰‡å¼å¸ƒå±€
- å“åº”å¼è®¾è®¡ï¼šå®Œç¾æ”¯æŒç§»åŠ¨ç«¯è®¿é—®

### åå°ç®¡ç†
- åŒºåŸŸç®¡ç†
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤åŒºåŸŸ
  - åŒºåŸŸæ’åº
- åˆ†ç±»ç®¡ç†
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤åˆ†ç±»
  - åˆ†ç±»æ’åº
  - åˆ†ç±»å½’å±åŒºåŸŸè®¾ç½®
- é“¾æ¥ç®¡ç†
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤é“¾æ¥
  - é“¾æ¥åˆ†ç±»è®¾ç½®
- ç”¨æˆ·ç®¡ç†
  - ç”¨æˆ·è®¤è¯
  - ç™»å½•ä¿æŠ¤
  - å¤±è´¥æ¬¡æ•°é™åˆ¶

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/maxazure/home.git
cd home
```

2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
npm install
```

3. åˆå§‹åŒ–æ•°æ®åº“
```bash
flask db upgrade
flask create-admin  # åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
```

4. ç¼–è¯‘CSS
```bash
npm run build:css  # æˆ– npx tailwindcss -i ./src/style.css -o ./css/style.css --watch
```

5. è¿è¡Œå¼€å‘æœåŠ¡å™¨
```bash
flask run --debug
```

## éƒ¨ç½²æ–¹å¼

### 1. Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### å‰ææ¡ä»¶
- å®‰è£… Docker
```bash
curl -fsSL https://get.docker.com | sh
```

- å®‰è£… Docker Compose
```bash
sudo apt install docker-compose
```

#### éƒ¨ç½²æ­¥éª¤

1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/maxazure/home.git
cd home
```

2. å¯åŠ¨åº”ç”¨
```bash
docker-compose up -d
```

3. é…ç½® Nginx åå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name your_domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static {
        alias /path/to/your/project/www;  # æ›¿æ¢ä¸ºé¡¹ç›® www ç›®å½•çš„å®é™…è·¯å¾„
        expires 30d;
    }
}
```

### 2. ä¼ ç»Ÿéƒ¨ç½²

1. å®‰è£… Python ä¾èµ–
```bash
pip install -r requirements.txt
```

2. åˆå§‹åŒ–æ•°æ®åº“
```bash
flask db upgrade  # æ‰§è¡Œæ•°æ®åº“è¿ç§»
python import_data.py  # å¯¼å…¥åˆå§‹æ•°æ®
```

3. ç¼–è¯‘ CSS
```bash
cd www && npx tailwindcss -i ./src/style.css -o ./css/style.css
```

4. è¿è¡Œåº”ç”¨
```bash
flask run
```

## ä½¿ç”¨è¯´æ˜

1. è®¿é—®é¦–é¡µ: `http://localhost:5000`
2. è®¿é—®ç®¡ç†åå°: `http://localhost:5000/admin`
   - é»˜è®¤ç®¡ç†å‘˜è´¦å·: admin
   - é»˜è®¤å¯†ç : admin

### åå°åŠŸèƒ½è¯´æ˜

1. åŒºåŸŸç®¡ç†
   - ç‚¹å‡»"æ·»åŠ åŒºåŸŸ"æŒ‰é’®åˆ›å»ºæ–°åŒºåŸŸ
   - ä½¿ç”¨æ‹–æ‹½åŠŸèƒ½è°ƒæ•´åŒºåŸŸé¡ºåº
   - ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ä¿®æ”¹åŒºåŸŸåç§°

2. åˆ†ç±»ç®¡ç†
   - åœ¨å¯¹åº”åŒºåŸŸä¸‹æ·»åŠ æ–°åˆ†ç±»
   - ä½¿ç”¨æ‹–æ‹½åŠŸèƒ½è°ƒæ•´åˆ†ç±»é¡ºåº
   - ç¼–è¾‘åˆ†ç±»ä¿¡æ¯æ—¶å¯æ›´æ”¹æ‰€å±åŒºåŸŸ

3. é“¾æ¥ç®¡ç†
   - åœ¨åˆ†ç±»ä¸‹æ·»åŠ æ–°é“¾æ¥
   - æ”¯æŒæ‰¹é‡å¯¼å…¥é“¾æ¥
   - å¯ä»¥ç§»åŠ¨é“¾æ¥åˆ°å…¶ä»–åˆ†ç±»

## æ•°æ®å¤‡ä»½

### è‡ªåŠ¨å¤‡ä»½
ç³»ç»Ÿåœ¨è¿›è¡Œæ•°æ®å¯¼å…¥æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶ `data_backup.json`

### æ‰‹åŠ¨å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
cp instance/links.db instance/links.db.backup
```

## ç³»ç»Ÿè¦æ±‚
- æœ€å°é…ç½®ï¼š1æ ¸ CPUï¼Œ1GB å†…å­˜
- æ¨èé…ç½®ï¼š2æ ¸ CPUï¼Œ2GB å†…å­˜

## å¼€å‘æŒ‡å—

### å‰ç«¯å¼€å‘

1. TailwindCSS é…ç½®
- é…ç½®æ–‡ä»¶ï¼š`www/tailwind.config.js`
- ä¸»é¢˜å®šåˆ¶ï¼šä¿®æ”¹ theme.extend ä¸­çš„é…ç½®

2. ç»„ä»¶æ ·å¼
- åŸºç¡€æ ·å¼ï¼š`www/src/style.css`
- è‡ªå®šä¹‰ç»„ä»¶ï¼šä½¿ç”¨ @layer components å®šä¹‰

3. JavaScript
- è®¤è¯ç›¸å…³ï¼š`www/js/auth.js`
- ç®¡ç†åŠŸèƒ½ï¼š`www/js/admin/*.js`

### åç«¯å¼€å‘

1. è·¯ç”±ç»„ç»‡
- ç®¡ç†æ¥å£ï¼š`routes/admin_routes.py`
- è®¤è¯æ¥å£ï¼š`routes/auth_routes.py`
- å‰å°æ¥å£ï¼š`routes/main_routes.py`

2. æ•°æ®æ¨¡å‹
- ä½ç½®ï¼š`models/`
- ä¸»è¦æ¨¡å‹ï¼šCategory, Link, User, IPBlock

3. APIå¼€å‘
- RESTé£æ ¼æ¥å£
- JSONåºåˆ—åŒ–ä½¿ç”¨ marshmallow
- ç»Ÿä¸€é”™è¯¯å¤„ç†

### CSS ä¿®æ”¹
ä¿®æ”¹ CSS åéœ€è¦é‡æ–°ç¼–è¯‘ï¼š
```bash
cd www && npx tailwindcss -i ./src/style.css -o ./css/style.css
```

### æ•°æ®åº“è¿ç§»
æ·»åŠ æ–°çš„æ•°æ®åº“å­—æ®µåéœ€è¦åˆ›å»ºè¿ç§»ï¼š
```bash
flask db migrate -m "è¿ç§»è¯´æ˜"
flask db upgrade
```

### æ•°æ®æ›´æ–°
1. æœ¬åœ°ä¿®æ”¹åæäº¤ä»£ç ï¼š
```bash
git add .
git commit -m "ä½ çš„æäº¤è¯´æ˜"
git push
```

2. æ›´æ–°æœåŠ¡å™¨æ•°æ®ï¼š
```bash
./update_server_data.sh  # å°†æœ¬åœ°çš„ links.db æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨
```

### Docker æ›´æ–°
1. SSH ç™»å½•æœåŠ¡å™¨ï¼š
```bash
ssh www@home
```

2. æ›´æ–°å¹¶é‡å¯æœåŠ¡ï¼š
```bash
cd /www/wwwroot/home.jayliu.co.nz
git pull

# å¦‚æœåªæ˜¯æ›´æ–°äº†ä»£ç ï¼Œä¸éœ€è¦é‡æ–°æ„å»ºé•œåƒ
docker compose down
docker compose up -d

# å¦‚æœä¿®æ”¹äº† Dockerfile æˆ–éœ€è¦é‡æ–°æ„å»ºé•œåƒ
docker compose down
docker compose up -d --build  # é‡æ–°æ„å»ºé•œåƒå¹¶å¯åŠ¨
```

### åå°ç•Œé¢è¯´æ˜
1. é¡¶éƒ¨å¯¼èˆªæ 
   - å·¦ä¾§æ˜¾ç¤º"å¯¼èˆªç®¡ç†åå°"æ ‡é¢˜
   - å³ä¾§ä¸ºé€€å‡ºç™»å½•æŒ‰é’®

2. å·¦ä¾§èœå•
   - åˆ†ç±»ç®¡ç†ï¼šç®¡ç†åŒºåŸŸå’Œåˆ†ç±»
   - é“¾æ¥ç®¡ç†ï¼šç®¡ç†æ‰€æœ‰é“¾æ¥
   - ç”¨æˆ·ç®¡ç†ï¼šç®¡ç†åå°ç”¨æˆ·
   - æŸ¥çœ‹é¦–é¡µï¼šè·³è½¬åˆ°å‰å°é¡µé¢

3. ä¸»è¦å†…å®¹åŒºåŸŸ
   - é¡¶éƒ¨æ˜¾ç¤ºå½“å‰é¡µé¢æ ‡é¢˜ï¼ˆåˆ†ç±»ç®¡ç†/é“¾æ¥ç®¡ç†/ç”¨æˆ·ç®¡ç†ï¼‰
   - ä¸‹æ–¹ä¸ºå…·ä½“çš„ç®¡ç†å†…å®¹

### æ³¨æ„äº‹é¡¹
1. åˆ é™¤åŒºåŸŸæ—¶ä¼šåŒæ—¶åˆ é™¤è¯¥åŒºåŸŸä¸‹çš„æ‰€æœ‰åˆ†ç±»å’Œé“¾æ¥
2. åˆ é™¤åˆ†ç±»æ—¶ä¼šåŒæ—¶åˆ é™¤è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰é“¾æ¥
3. æ¯æ¬¡ä¿®æ”¹æ•°æ®åº“åï¼Œè¯·åŠæ—¶æ‰§è¡Œ update_server_data.sh æ›´æ–°æœåŠ¡å™¨æ•°æ®
4. ä»£ç æ›´æ–°åï¼Œéœ€è¦é‡å¯ Docker å®¹å™¨ä½¿æ›´æ”¹ç”Ÿæ•ˆ

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥å¸®åŠ©æ”¹è¿›é¡¹ç›®ã€‚

## è®¸å¯è¯

MIT License