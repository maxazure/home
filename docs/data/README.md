# 数据管理文档

## 目录

1. [数据导入](#数据导入)
2. [数据格式](#数据格式)
3. [数据备份](#数据备份)
4. [错误处理](#错误处理)

## 数据导入

### 使用方法

1. 使用内置数据导入：
```bash
python import_data.py
```

2. 从JSON文件导入数据：
```bash
python import_data.py data.json
```

### 导入过程

1. 数据验证
   - 验证数据结构完整性
   - 验证URL有效性
   - 检查必要字段存在

2. 数据备份
   - 自动备份现有数据到 `data_backup.json`
   - 备份包含分类和链接信息

3. 数据导入
   - 清空现有数据
   - 按层级导入新数据
   - 保持数据关联关系

## 数据格式

### JSON结构

```json
[
    {
        "sectionName": "分区名称",
        "rows": [
            {
                "columns": [
                    {
                        "title": "分类标题",
                        "links": [
                            {
                                "name": "链接名称",
                                "url": "链接地址"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]
```

### 字段说明

- `sectionName`: 分区名称（必填）
- `rows`: 行数据数组（必填）
- `columns`: 列数据数组（必填）
- `title`: 分类标题（必填）
- `links`: 链接数组（必填）
  - `name`: 链接名称（必填）
  - `url`: 链接地址（必填，可为空字符串）

### URL规则

支持以下URL格式：
1. 标准HTTP/HTTPS URL（如：`https://www.example.com`）
2. 网络共享路径（如：`\\server\share`）
3. 空URL（允许为空字符串）

## 数据备份

### 备份文件

备份数据保存在 `data_backup.json` 文件中，包含：
1. 分类数据（categories）
   - ID
   - 标题
   - 分区名称

2. 链接数据（links）
   - ID
   - 名称
   - URL
   - 分类ID

### 备份格式

```json
{
    "categories": [
        {
            "id": 1,
            "title": "分类标题",
            "section_name": "分区名称"
        }
    ],
    "links": [
        {
            "id": 1,
            "name": "链接名称",
            "url": "链接地址",
            "category_id": 1
        }
    ]
}
```

## 错误处理

### 数据验证错误

1. 结构错误
   - 数据类型不匹配
   - 必要字段缺失
   - 格式不正确

2. URL错误
   - 格式无效
   - 协议不支持

### 导入错误

1. 文件错误
   - 文件不存在
   - 文件格式错误
   - 编码错误

2. 数据库错误
   - 连接失败
   - 事务失败
   - 约束违反

### 错误恢复

1. 自动恢复
   - 导入失败时自动回滚
   - 尝试恢复备份数据
   - 提供错误详情

2. 手动恢复
   - 使用备份文件恢复
   - 查看错误日志
   - 修复数据问题

### 错误提示

程序会提供详细的错误信息：
- 数据验证失败的具体原因
- 数据库操作失败的详细信息
- 恢复操作的结果报告 